<!DOCTYPE html>
<html>
  <head>
    <title>jQuery Lab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      .page-header {
        background: #fff;
        border-bottom: 1px solid rgba(0, 0, 0, 0.16);
        position: sticky;
        top: 0;
        left: 0;
        width: 100%;
        height: 52px;
      }
      .section-block {
        display: block;
        border-bottom: 1px solid rgba(0, 0, 0, 0.16);

        padding: 15px;
        width: 100%;
        min-height: 100vh;
      }
      #car_video_container {
        display: block;
        margin: 60px auto;
        width: 1100px;
        text-align: center;
      }
      #car_video {
        margin: 0 auto;
      }
      #landing_video,
      .landing_page_content {
        display: block;
        margin: 15px auto;
        width: 480px;
        text-align: center;
      }
      .developer-panel {
        background: #383737;
        color: #00fd61;
        padding: 15px;
        position: fixed;
        right: 15px;
        bottom: 15px;
        width: 180px;
        min-height: 60px;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <header id="page_header" class="page-header">
      <div class="container">
        <h1>iPhone 101</h1>
      </div>
    </header>
    <div class="container">
      <section class="section-block">
        <video id="landing_video" width="480" autoplay loop muted>
          <source src="public/large.mp4" type="video/mp4" />
          เสียใจจัง เว็บเบราว์เซอร์คุณไม่ รองรับ HTML5 Video Tag
        </video>
        <div class="landing_page_content">
          <h2>พอเหมาะพอดี<br />กับเวลาที่ต้องเรียกตรวจรับลายเซ็นเลย</h2>
          <p>
            ทั้งระบบการเรียนแบบใหม่ผ่าน Zoom
            ที่ให้คุณเก็บวิดีโอสิ่งที่คุณเห็นและรักได้เต็มตามากขึ้น
            โค้ดที่เยอะที่สุดเท่าที่เคยมีมาและแบตเตอรี่ที่ใช้งานได้ตลอดวัน
            ที่ให้คุณทำอะไรๆ ได้มากขึ้น แต่ชาร์จน้อยลง
            ประกอบกับวิดีโอคุณภาพสูงที่สุดในสมาร์ทโฟน
            ชัดเลยว่าครั้งนี้ความทรงจำของคุณจะดูดี ยิ่งกว่าครั้งไหนๆ
          </p>
        </div>
      </section>

      <section id="trigger" class="section-block">
        <header>
          <h2>เอาล่ะ เรามาย่อวีดิโอกัน</h2>
        </header>
        <div>
          <figure id="car_video_container">
            <video id="car_video" width="1100" autoplay loop muted>
              <source
                src="public/c388898d-dce7-4b62-b3f5-ae5f7cc981c6.mp4"
                type="video/mp4"
              />
              เสียใจจัง เว็บเบราว์เซอร์คุณไม่รองรับ HTML5 Video Tag
            </video>
          </figure>
        </div>
      </section>

      <section class="section-block">
        <h2>Section 3</h2>
      </section>
      <div class="developer-panel">
        <section class="mb-3">
          <header>#page_header's position</header>
          <div>
            <div>Top: <span id="window_top"></span></div>
            <div>Left: <span id="window_left"></span></div>
          </div>
        </section>

        <section class="mb-3">
          <header>#trigger's position</header>
          <div>
            <div>Top: <span id="trigger_top"></span></div>
            <div>Height: <span id="trigger_height"></span></div>
          </div>
        </section>

        <section class="mb-3">
          <header>Current position within #trigger?</header>
          <div>
            <div>Result: <span id="top_reach"></span></div>
          </div>
        </section>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      // ทำโค้ดนี้ให้สมบูรณ์
      $(document).ready(function () {
        // อ้างอิงถึง element ที่จำเป็น
        const $pageHeader = $("#page_header");
        const $triggerSection = $("#trigger");
        const $carVideo = $("#car_video");
        const $windowTop = $("#window_top");
        const $windowLeft = $("#window_left");
        const $triggerTop = $("#trigger_top");
        const $triggerHeight = $("#trigger_height");
        const $topReach = $("#top_reach");

        // กำหนดค่าเริ่มต้นของวิดีโอ
        const initialVideoWidth = $carVideo.width();
        const initialVideoHeight = $carVideo.height();
        const minVideoWidth = 480; // กำหนดขนาดวิดีโอที่เล็กลงได้
        const minVideoHeight =
          (minVideoWidth / initialVideoWidth) * initialVideoHeight; // คำนวณความสูงตามสัดส่วน

        // ฟังก์ชันอัปเดตข้อมูลใน developer panel
        function updateDeveloperPanel() {
          const pageHeaderPosition = $pageHeader.position();
          const triggerPosition = $triggerSection.position();

          $windowTop.text(pageHeaderPosition.top);
          $windowLeft.text(pageHeaderPosition.left);
          $triggerTop.text(triggerPosition.top);
          $triggerHeight.text($triggerSection.height());

          // คำนวณตำแหน่งปัจจุบันเมื่อเทียบกับส่วน #trigger
          const scrollTop = $(window).scrollTop();
          const triggerOffsetTop = triggerPosition.top;
          const triggerSectionHeight = $triggerSection.height();

          let currentPositionInTrigger = scrollTop - triggerOffsetTop;
          if (currentPositionInTrigger < 0) {
            currentPositionInTrigger = 0;
          } else if (currentPositionInTrigger > triggerSectionHeight) {
            currentPositionInTrigger = triggerSectionHeight;
          }
          $topReach.text(currentPositionInTrigger.toFixed(2)); // แสดงผลเป็นทศนิยม 2 ตำแหน่ง
        }

        // ฟังก์ชันปรับขนาดวิดีโอเมื่อ scroll
        function adjustVideoSize() {
          const scrollTop = $(window).scrollTop();
          const triggerOffsetTop = $triggerSection.offset().top;
          const triggerSectionHeight = $triggerSection.height();

          // ตรวจสอบว่าอยู่ภายในช่วงของ #trigger หรือไม่
          if (
            scrollTop > triggerOffsetTop &&
            scrollTop < triggerOffsetTop + triggerSectionHeight
          ) {
            // คำนวณความคืบหน้าในการเลื่อนภายในส่วน #trigger (0 ถึง 1)
            const scrollProgress =
              (scrollTop - triggerOffsetTop) / triggerSectionHeight;

            // คำนวณขนาดวิดีโอใหม่แบบเส้นตรง
            const newWidth =
              initialVideoWidth -
              (initialVideoWidth - minVideoWidth) * scrollProgress;
            const newHeight =
              initialVideoHeight -
              (initialVideoHeight - minVideoHeight) * scrollProgress;

            // Set ค่าขนาดใหม่ให้กับวิดีโอ
            $carVideo.width(newWidth);
            $carVideo.height(newHeight);
          } else if (scrollTop <= triggerOffsetTop) {
            // ถ้าเลื่อนกลับไปอยู่ด้านบนของ #trigger ให้กลับไปขนาดเดิม
            $carVideo.width(initialVideoWidth);
            $carVideo.height(initialVideoHeight);
          } else {
            // ถ้าเลื่อนเลย #trigger ไปแล้ว ให้เป็นขนาดเล็กสุด
            $carVideo.width(minVideoWidth);
            $carVideo.height(minVideoHeight);
          }
        }

        // เมื่อโหลดหน้าเว็บเสร็จ
        updateDeveloperPanel(); // อัปเดตข้อมูลครั้งแรก
        adjustVideoSize(); // ปรับขนาดวิดีโอครั้งแรก

        // Event .scroll()
        $(window).scroll(function () {
          updateDeveloperPanel();
          adjustVideoSize();
        });

        // Event .resize() ในกรณีที่ขนาดหน้าจอเปลี่ยน (เช่น หมุนหน้าจอมือถือ)
        $(window).resize(function () {
          updateDeveloperPanel();
          adjustVideoSize();
        });
      });
    </script>
  </body>
</html>
